<?php

namespace AppBundle\Repository;

/**
 * ZoneRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ZoneRepository extends \Doctrine\ORM\EntityRepository
{
  /**
    * Fonction de recuperation du dernier identifiant de la base de donnÃ©es
    *
    * Author: Delrodie AMOIKON
    * Date: 10/10/2016 19/57
    */
    public function getDernierId()
    {
        $qb = $this->createQueryBuilder('z')
            ->select('count(z.id)')
        ;

        $query = $qb->getQuery();

        $recup =  $query->getSingleScalarResult();

        // Si compteur est egal a 0 alors initialiser
        if ($recup < 10){
            $suffixe = $recup + 1;
            return $code = '0'.$suffixe;
        }
        else{
            return $code = $recup;
        }
    }

    /**
      * Recherche de l'article de la rubrique zone
      *
      * Author: Delrodie AMOIKON
      * Date: 14/02/2017
      * Since: v1.0
      */
      public function getZone()
      {
          $em = $this->getEntityManager();
          $qb = $em->createQuery('
              SELECT z
              FROM AppBundle:Zone z
              WHERE z.desactivation = :stat
              ORDER BY z.libelle ASC
          ')
            ->setParameter('stat', 0)
          ;
          try {
              $result = $qb->getResult();

              return $result;

          } catch (NoResultException $e) {
              return $e;
          }
      }
}
